<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer DANA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Semua CSS yang sama tetap dipertahankan */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        :root {
            --dana-blue: #00a2ff;
            --dana-dark: #0088cc;
            --gopay-green: #00aa13;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-light: #999999;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --border: #e8e8e8;
            --success: #00c853;
            --divider: #f0f0f0;
        }
        
        body {
            background: #e8ecef;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .phone-mockup {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 44px;
            padding: 14px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .screen {
            width: 100%;
            height: 100%;
            background: #ffffff;
            border-radius: 36px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .status-bar {
            height: 44px;
            background: var(--dana-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            position: relative;
            z-index: 100;
        }
        
        .status-left {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-right {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 210px;
            height: 32px;
            background: #000;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            z-index: 90;
        }
        
        .content-area {
            flex: 1;
            overflow-y: auto;
            background: var(--background);
            position: relative;
        }
        
        .bottom-nav {
            height: 84px;
            background: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--border);
            padding: 8px 20px 24px;
            position: relative;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            font-size: 11px;
            gap: 6px;
            flex: 1;
        }
        
        .nav-item.active {
            color: var(--dana-blue);
        }
        
        .nav-icon {
            font-size: 22px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page {
            display: none;
            height: 100%;
            flex-direction: column;
        }
        
        .page.active {
            display: flex;
        }
        
        /* HEADER STYLES */
        .header {
            background: var(--dana-blue);
            color: white;
            padding: 12px 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header.gopay {
            background: var(--gopay-green);
        }
        
        .header-title {
            font-size: 17px;
            font-weight: 700;
            letter-spacing: -0.2px;
        }
        
        .back-btn {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        /* TRANSACTION CARD STYLES */
        .transaction-card {
            background: white;
            margin: 16px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        
        .card-section {
            padding: 20px;
            border-bottom: 1px solid var(--divider);
        }
        
        .card-section:last-child {
            border-bottom: none;
        }
        
        .transaction-date {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
            font-weight: 500;
        }
        
        .recipient-info {
            margin-bottom: 4px;
        }
        
        .recipient-number {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            letter-spacing: -0.2px;
        }
        
        .transaction-status {
            color: var(--success);
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }
        
        .merchant-name {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .total-section {
            text-align: center;
            padding: 24px 20px;
        }
        
        .total-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .total-amount {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }
        
        .payment-section h3 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .payment-detail {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .payment-icon {
            width: 28px;
            height: 28px;
            background: var(--dana-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }
        
        .payment-icon.gopay {
            background: var(--gopay-green);
        }
        
        .detail-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .divider {
            height: 1px;
            background: var(--divider);
            margin: 16px 0;
        }
        
        .ad-container {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            border: 1px solid #e8e8e8;
        }
        
        .ad-title {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 15px;
            color: var(--text-primary);
        }
        
        .ad-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .ad-source {
            font-size: 12px;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .share-section {
            padding: 20px;
            text-align: center;
        }
        
        .share-button {
            background: var(--dana-blue);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 162, 255, 0.3);
        }
        
        .share-button.gopay {
            background: var(--gopay-green);
            box-shadow: 0 2px 8px rgba(0, 170, 19, 0.3);
        }
        
        .share-button:active {
            transform: scale(0.98);
            box-shadow: 0 1px 4px rgba(0, 162, 255, 0.3);
        }
        
        .share-button.gopay:active {
            box-shadow: 0 1px 4px rgba(0, 170, 19, 0.3);
        }
        
        /* INPUT PAGE STYLES */
        .input-container {
            padding: 24px 20px;
            background: white;
            margin: 16px;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .input-field {
            width: 100%;
            padding: 16px;
            border: 1.5px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--dana-blue);
            box-shadow: 0 0 0 3px rgba(0, 162, 255, 0.1);
        }
        
        .select-field {
            width: 100%;
            padding: 16px;
            border: 1.5px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.2s ease;
            font-weight: 500;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }
        
        .select-field:focus {
            outline: none;
            border-color: var(--dana-blue);
            box-shadow: 0 0 0 3px rgba(0, 162, 255, 0.1);
        }
        
        .primary-button {
            background: var(--dana-blue);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 162, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .primary-button:active {
            transform: scale(0.98);
            box-shadow: 0 1px 4px rgba(0, 162, 255, 0.3);
        }
        
        /* SCREENSHOT PAGE STYLES */
        .screenshot-page {
            padding: 24px 20px;
            text-align: center;
        }
        
        .success-indicator {
            width: 80px;
            height: 80px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            color: white;
            font-size: 32px;
            box-shadow: 0 4px 12px rgba(0, 200, 83, 0.3);
        }
        
        .success-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--success);
        }
        
        .success-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }
        
        .screenshot-preview {
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: 24px;
            border: 1px solid var(--border);
            background: white;
        }
        
        .download-button {
            background: var(--success);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 200, 83, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .download-button:active {
            transform: scale(0.98);
            box-shadow: 0 1px 4px rgba(0, 200, 83, 0.3);
        }
        
        .secondary-button {
            background: transparent;
            color: var(--dana-blue);
            border: 2px solid var(--dana-blue);
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .secondary-button:active {
            background: rgba(0, 162, 255, 0.1);
        }
        
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* SCROLLBAR STYLING */
        .content-area::-webkit-scrollbar {
            width: 4px;
        }
        
        .content-area::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .content-area::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 2px;
        }
        
        /* DANA SPECIFIC STYLES */
        .dana-logo {
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .transaction-id {
            font-size: 12px;
            color: var(--text-light);
            text-align: center;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="phone-mockup">
        <div class="notch"></div>
        <div class="screen">
            <div class="status-bar">
                <div class="status-left">
                    <span id="currentTime">11:35</span>
                </div>
                <div class="status-right">
                    <i class="fas fa-signal"></i>
                    <i class="fas fa-wifi"></i>
                    <i class="fas fa-battery-three-quarters"></i>
                </div>
            </div>
            
            <div class="content-area">
                <!-- INPUT PAGE -->
                <div class="page active" id="inputPage">
                    <div class="header">
                        <h1 class="header-title">Transfer DANA/GoPay</h1>
                    </div>
                    
                    <div class="input-container">
                        <div class="input-group">
                            <label class="input-label" for="paymentMethod">Metode Pembayaran</label>
                            <select id="paymentMethod" class="select-field">
                                <option value="dana">DANA</option>
                                <option value="gopay">GoPay</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="nomor">Nomor Penerima</label>
                            <input type="text" id="nomor" class="input-field" placeholder="Contoh: 0895•••••9051" value="0895•••••9051">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="nama">Nama Penerima</label>
                            <input type="text" id="nama" class="input-field" placeholder="Contoh: Toko Wpulsa" value="Toko Wpulsa">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="jumlah">Jumlah Transfer (Rp)</label>
                            <input type="text" id="jumlah" class="input-field" placeholder="Contoh: 156.000" value="156.000">
                        </div>
                        
                        <button class="primary-button" id="generateBtn">
                            <i class="fas fa-bolt"></i>
                            Buat Tampilan Transfer
                        </button>
                    </div>
                </div>
                
                <!-- TRANSFER PAGE -->
                <div class="page" id="transferPage">
                    <div class="header" id="transferHeader">
                        <button class="back-btn" id="backFromTransfer">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h1 class="header-title" id="transferTitle">BISNIS</h1>
                    </div>
                    
                    <div class="transaction-card">
                        <div class="card-section">
                            <div class="transaction-date" id="dateInfo">18 Sep 2025 • 11:35</div>
                            <div class="recipient-info">
                                <div class="recipient-number" id="recipientNumber">ID DANA 0895•••••9051</div>
                                <div class="transaction-status">
                                    <i class="fas fa-check-circle"></i>
                                    Transaksi berhasil!
                                </div>
                                <div class="merchant-name" id="merchantName">- Pembayaran ke Toko Wpulsa</div>
                            </div>
                        </div>
                        
                        <div class="card-section total-section">
                            <div class="total-label">Total Bayar</div>
                            <div class="total-amount" id="totalAmount">Rp156.000</div>
                        </div>
                        
                        <div class="card-section payment-section">
                            <h3>Metode Pembayaran</h3>
                            <div class="payment-detail">
                                <div class="payment-icon" id="paymentIcon">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <span id="paymentMethodText">Saldo DANA</span>
                            </div>
                        </div>
                        
                        <div class="card-section">
                            <div class="detail-title">Detail Transaksi</div>
                            <div class="divider"></div>
                            
                            <div class="ad-container">
                                <div class="ad-title">Dapatkan $5 per jawaban</div>
                                <div class="ad-description">Hasilkan uang dari menjawab pertanyaan sederhana. Kami membayar Anda secara tunai.</div>
                                <div class="ad-source">
                                    <i class="fas fa-info-circle"></i> 0 • Iklan oleh Google
                                </div>
                            </div>
                            
                            <div class="divider"></div>
                            <div class="transaction-id" id="transactionId">ID Transaksi: DANA2025092911350895</div>
                        </div>
                    </div>
                    
                    <div class="share-section">
                        <button class="share-button" id="screenshotBtn">
                            <i class="fas fa-camera"></i>
                            AMBIL SCREENSHOT
                        </button>
                    </div>
                </div>
                
                <!-- SCREENSHOT PAGE -->
                <div class="page" id="screenshotPage">
                    <div class="header">
                        <button class="back-btn" id="backFromScreenshot">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h1 class="header-title">Screenshot</h1>
                    </div>
                    
                    <div class="screenshot-page">
                        <div class="success-indicator">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="success-title">Screenshot Berhasil!</div>
                        <div class="success-subtitle">Gambar siap untuk diunduh</div>
                        
                        <canvas id="screenshotPreview" class="screenshot-preview"></canvas>
                        
                        <button class="download-button" id="downloadBtn">
                            <i class="fas fa-download"></i>
                            Download Screenshot
                        </button>
                        
                        <button class="secondary-button" id="newTransferBtn">
                            <i class="fas fa-plus"></i>
                            Buat Transfer Baru
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="bottom-nav">
                <div class="nav-item">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                    <div>Home</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon"><i class="fas fa-tag"></i></div>
                    <div>Promo</div>
                </div>
                <div class="nav-item active">
                    <div class="nav-icon"><i class="fas fa-qrcode"></i></div>
                    <div>Bayar</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon"><i class="fas fa-inbox"></i></div>
                    <div>Inbox</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon"><i class="fas fa-ellipsis-h"></i></div>
                    <div>Lainnya</div>
                </div>
            </div>
        </div>
    </div>

    <!-- HIDDEN CONTAINER FOR SCREENSHOT -->
    <div id="screenshotContainer" style="position: fixed; top: -9999px; left: -9999px; width: 375px; background: #f8f9fa;"></div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // Update waktu real-time
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('currentTime').textContent = timeStr;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        // Page elements
        const inputPage = document.getElementById('inputPage');
        const transferPage = document.getElementById('transferPage');
        const screenshotPage = document.getElementById('screenshotPage');
        let screenshotCanvas = null;
        let currentPaymentMethod = 'dana';
        
        // Navigation buttons
        document.getElementById('generateBtn').addEventListener('click', showTransferPage);
        document.getElementById('backFromTransfer').addEventListener('click', showInputPage);
        document.getElementById('screenshotBtn').addEventListener('click', takeScreenshot);
        document.getElementById('backFromScreenshot').addEventListener('click', showTransferPage);
        document.getElementById('newTransferBtn').addEventListener('click', showInputPage);
        document.getElementById('downloadBtn').addEventListener('click', downloadScreenshot);
        
        // Payment method change
        document.getElementById('paymentMethod').addEventListener('change', function() {
            currentPaymentMethod = this.value;
        });
        
        function showInputPage() {
            inputPage.classList.add('active', 'fade-in');
            transferPage.classList.remove('active');
            screenshotPage.classList.remove('active');
        }
        
        function showTransferPage() {
            // Get input values
            const nomor = document.getElementById('nomor').value || '0895•••••9051';
            const nama = document.getElementById('nama').value || 'Toko Wpulsa';
            let jumlah = document.getElementById('jumlah').value || '156.000';
            
            // Format amount to Indonesian currency
            const formattedJumlah = 'Rp' + jumlah;
            
            // Update content based on payment method
            updateTransferPage(currentPaymentMethod, nomor, nama, formattedJumlah);
            
            // Update date to current
            const now = new Date();
            const options = { day: 'numeric', month: 'short', year: 'numeric' };
            const dateStr = now.toLocaleDateString('id-ID', options);
            const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('dateInfo').textContent = `${dateStr} • ${timeStr}`;
            
            // Show transfer page
            inputPage.classList.remove('active');
            transferPage.classList.add('active', 'fade-in');
            screenshotPage.classList.remove('active');
        }
        
        function updateTransferPage(method, nomor, nama, jumlah) {
            const header = document.getElementById('transferHeader');
            const title = document.getElementById('transferTitle');
            const recipientNumber = document.getElementById('recipientNumber');
            const paymentIcon = document.getElementById('paymentIcon');
            const paymentMethodText = document.getElementById('paymentMethodText');
            const screenshotBtn = document.getElementById('screenshotBtn');
            const transactionId = document.getElementById('transactionId');
            
            if (method === 'dana') {
                // Update for DANA
                header.className = 'header';
                title.textContent = 'BISNIS';
                recipientNumber.textContent = `ID DANA ${nomor}`;
                paymentIcon.className = 'payment-icon';
                paymentMethodText.textContent = 'Saldo DANA';
                screenshotBtn.className = 'share-button';
                transactionId.textContent = `ID Transaksi: DANA${new Date().getFullYear()}${(new Date().getMonth()+1).toString().padStart(2, '0')}${new Date().getDate().toString().padStart(2, '0')}${new Date().getHours().toString().padStart(2, '0')}${new Date().getMinutes().toString().padStart(2, '0')}${nomor.slice(-4)}`;
            } else {
                // Update for GoPay
                header.className = 'header gopay';
                title.textContent = 'TRANSAKSI';
                recipientNumber.textContent = `ID GoPay ${nomor}`;
                paymentIcon.className = 'payment-icon gopay';
                paymentMethodText.textContent = 'Saldo GoPay';
                screenshotBtn.className = 'share-button gopay';
                transactionId.textContent = `ID Transaksi: GOPAY${new Date().getFullYear()}${(new Date().getMonth()+1).toString().padStart(2, '0')}${new Date().getDate().toString().padStart(2, '0')}${new Date().getHours().toString().padStart(2, '0')}${new Date().getMinutes().toString().padStart(2, '0')}${nomor.slice(-4)}`;
            }
            
            // Update common elements
            document.getElementById('merchantName').textContent = `- Pembayaran ke ${nama}`;
            document.getElementById('totalAmount').textContent = jumlah;
        }
        
        function takeScreenshot() {
            // Show loading state
            const screenshotBtn = document.getElementById('screenshotBtn');
            const originalText = screenshotBtn.innerHTML;
            screenshotBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> MEMPROSES...';
            screenshotBtn.disabled = true;
            
            // Create a clean copy for screenshot
            const transferPageClone = transferPage.cloneNode(true);
            const backBtn = transferPageClone.querySelector('#backFromTransfer');
            if (backBtn) backBtn.remove();
            
            // Add to screenshot container
            const screenshotContainer = document.getElementById('screenshotContainer');
            screenshotContainer.innerHTML = '';
            screenshotContainer.appendChild(transferPageClone);
            
            // Set explicit height for the cloned element
            transferPageClone.style.height = 'auto';
            transferPageClone.style.minHeight = '700px';
            transferPageClone.style.overflow = 'visible';
            
            // Ensure all styles are applied
            setTimeout(() => {
                // Take screenshot (HD using devicePixelRatio)
                const scaleFactor = (window.devicePixelRatio || 1) * 2;
                html2canvas(transferPageClone, {
                    backgroundColor: '#f8f9fa',
                    scale: scaleFactor,
                    useCORS: true,
                    logging: false,
                    width: 375,
                    height: transferPageClone.scrollHeight,
                    windowWidth: 375,
                    onclone: function(clonedDoc) {
                        // Ensure all elements are visible
                        const allElements = clonedDoc.querySelectorAll('*');
                        allElements.forEach(el => {
                            el.style.visibility = 'visible';
                            el.style.opacity = '1';
                        });
                        
                        // Ensure proper styling for the cloned page
                        const clonedTransferPage = clonedDoc.querySelector('#transferPage');
                        if (clonedTransferPage) {
                            clonedTransferPage.style.display = 'flex';
                            clonedTransferPage.style.flexDirection = 'column';
                            clonedTransferPage.style.height = 'auto';
                            clonedTransferPage.style.minHeight = '700px';
                            clonedTransferPage.style.overflow = 'visible';
                        }
                    }
                }).then(canvas => {
                    screenshotCanvas = canvas;
                    
                    // Show preview (scale down for preview but keep quality)
                    const preview = document.getElementById('screenshotPreview');
                    const ctx = preview.getContext('2d');
                    
                    // target preview size: fit to container width (375) / 2 for visual
                    const targetWidth = Math.round(canvas.width / scaleFactor);
                    const targetHeight = Math.round(canvas.height / scaleFactor);
                    
                    preview.width = targetWidth;
                    preview.height = targetHeight;
                    // improve smoothing quality
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    // clear and draw
                    ctx.clearRect(0, 0, preview.width, preview.height);
                    ctx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, preview.width, preview.height);
                    
                    // Show screenshot page
                    transferPage.classList.remove('active');
                    screenshotPage.classList.add('active', 'fade-in');
                    
                    // Reset button
                    screenshotBtn.innerHTML = originalText;
                    screenshotBtn.disabled = false;
                }).catch(error => {
                    console.error('Screenshot error:', error);
                    alert('Gagal mengambil screenshot. Silakan coba lagi.');
                    screenshotBtn.innerHTML = originalText;
                    screenshotBtn.disabled = false;
                });
            }, 100);
        }
        
        function downloadScreenshot() {
            if (!screenshotCanvas) {
                alert('Silakan buat screenshot terlebih dahulu');
                return;
            }
            
            try {
                // Prefer toBlob (better for large images / memory)
                if (screenshotCanvas.toBlob) {
                    screenshotCanvas.toBlob(function(blob) {
                        if (!blob) {
                            // fallback to toDataURL if blob fails
                            const dataUrl = screenshotCanvas.toDataURL('image/png');
                            const link = document.createElement('a');
                            link.href = dataUrl;
                            link.download = `transfer_${currentPaymentMethod}_${Date.now()}.png`;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            return;
                        }
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `transfer_${currentPaymentMethod}_${Date.now()}.png`;
                        // append the link, click then remove
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        // release memory
                        setTimeout(() => URL.revokeObjectURL(url), 10000);
                    }, 'image/png');
                } else {
                    // Older browsers fallback
                    const dataUrl = screenshotCanvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = dataUrl;
                    link.download = `transfer_${currentPaymentMethod}_${Date.now()}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            } catch (error) {
                console.error('Download error:', error);
                alert('Gagal mengunduh screenshot. Silakan coba lagi.');
            }
        }
        
        // Format amount input
        document.getElementById('jumlah').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString('id-ID');
                e.target.value = value;
            } else {
                e.target.value = '';
            }
        });
    </script>
</body>
    </html>
